---
title: "Chapter 2: Geographic data in R"
author: "Robin Lovelace, Jakub Nowosad, Jannes Muenchow"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{geocompr-solutions2}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(collapse = TRUE, comment = "#>")
```

## Prerequisites {-}

The solutions assume the following packages are attached (other packages will be attached when needed):

```{r packages, message=FALSE, warning=FALSE}
library(sf)
library(dplyr)
library(raster)
library(spData)
```

# Chapter 2

<!-- ## Vector data model -->

1) Use `summary()` on the geometry column of the `world` data object. What does the output tell us about:
    - Its geometry type?
    - The number of countries?
    - Its coordinate reference system (CRS)?

    ```{r}
    summary(st_geometry(world))
    ```
  
   - The geometry type: `MULTIPOLYGON`, there are 177 countries and the coordinate reference system (CRS) is WGS84 (EPSG 4326)

2) Run the code that 'generated' the map of the world in this [Figure](https://geocompr.robinlovelace.net/spatial-class.html#fig:contpop) at the end of this [section](https://geocompr.robinlovelace.net/spatial-class.html#base-args).
Find two similarities and two differences between the image on your computer and that in the book.
   - What does the `cex` argument do (see `?plot`)?
   - Why was `cex` set to the `sqrt(world$pop) / 10000`?
   - Bonus: experiment with different ways to visualize the global population.
    
The version generated by the code and the version in the book are shown in the left and right figures, respectively:

```{r, fig.show='hold', warning=FALSE}
old_par = par() # save graphical parameters

# generate version based on code in the book
plot(world["continent"], reset = FALSE)
cex = sqrt(world$pop) / 10000
world_cents = st_centroid(world, of_largest = TRUE)
plot(st_geometry(world_cents), add = TRUE, cex = cex, reset = TRUE)

# generate version in the book from online script:
par(old_par)
s = "https://github.com/Robinlovelace/geocompr/raw/main/code/02-contpop.R"
source(s)
```
    
Similarities: global extent, colorscheme, size of circles

Differences: projection (Antarctica is much smaller for example), graticules, location of points in the countries.

To understand these differences read-over, run, and experiment with different argument values in this script: https://github.com/Robinlovelace/geocompr/raw/main/code/02-contpop.R

`cex` refers to the diameter of symbols plotted, as explained by the help page `?graphics::points`. It is an acronym for 'Chacter symbol EXpansion'.
It was set to the square route of the population divided by 10,000 because a) otherwise the symbols would not fit on the map and b) to make circle area proportional to population.

3) Use `plot()` to create maps of Nigeria in context (see section https://geocompr.robinlovelace.net/spatial-class.html#basic-map).
    - Adjust the `lwd`, `col` and `expandBB` arguments of `plot()`. 
    - Challenge: read the documentation of `text()` and annotate the map.
    <!-- - Bonus: make the country boundaries a dotted gray line. -->
    <!-- - Hint: `border` is an additional argument of `plot()` for **sf**  objects. -->

```{r nigeria, warning=FALSE, fig.cap="Map of Nigeria in context illustrating sf's plotting capabilities"}
nigeria = world[world$name_long == "Nigeria", ]
africa = world[world$continent == "Africa", ]
plot(st_geometry(nigeria), col = "white", lwd = 3, main = "Nigeria in context", border = "lightgrey", expandBB = c(0.5, 0.2, 0.5, 0.2))
plot(st_geometry(world), lty = 3, add = TRUE, border = "grey")
plot(st_geometry(nigeria), col = "yellow", add = TRUE, border = "darkgrey")
a = africa[grepl("Niger", africa$name_long), ]
ncentre = st_centroid(a)
ncentre_num = st_coordinates(ncentre)
text(x = ncentre_num[, 1], y = ncentre_num[, 2], labels = a$name_long)
```

4) Create an empty `RasterLayer` object called `my_raster` with 10 columns and 10 rows.

Assign random values between 0 and 10 to the new raster and plot it.

```{r}
set.seed(2018-09-03)
my_raster = raster(ncol = 10, nrow = 10, vals = runif(n = 100, min = 0, max = 10))
plot(my_raster)
```

<!-- raster exercises -->
5) Read the `raster/nlcd2011.tif` file from the **spDataLarge** package. 
What kind of information can you get about the properties of this file?

```{r}
nlcd = raster(system.file("raster/nlcd2011.tif", package = "spDataLarge"))
nlcd
```

You can get information about:

  - dimensions - a number of rows (`nrow`), a number of columns (`ncol`), a   total number of cells (`ncell`)
  - resolution - x and y resolution in the map units
  - spatial extent of the dataset - `xmin`, `xmax`, `ymin`, `ymax`
  - coordinate reference system
  - range of values - `min` and `max`
